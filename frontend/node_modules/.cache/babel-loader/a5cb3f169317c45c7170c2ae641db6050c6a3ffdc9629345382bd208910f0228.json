{"ast":null,"code":"var _jsxFileName = \"D:\\\\Uknord5he\\\\BH3\\\\dev\\\\diplomas\\\\frontend\\\\src\\\\hooks\\\\useAuth.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$();\n// frontend/src/hooks/useAuth.js\nimport React, { createContext, useCallback, useContext, useEffect, useState } from 'react';\nimport api from '../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst EP_ME = '/me';\nconst EP_LOGIN = '/login';\nconst EP_REGISTER = '/register';\nconst STORAGE_KEY = 'auth/state/v1';\nfunction loadState() {\n  try {\n    return JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null');\n  } catch {\n    return null;\n  }\n}\nfunction saveState(s) {\n  try {\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(s));\n  } catch {}\n}\nfunction useAuthState() {\n  _s();\n  var _loadState;\n  const [user, setUser] = useState(((_loadState = loadState()) === null || _loadState === void 0 ? void 0 : _loadState.user) || null);\n  const [loading, setLoading] = useState(true);\n  const fetchMe = useCallback(async () => {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setUser(null);\n      setLoading(false);\n      return;\n    }\n    try {\n      const {\n        data\n      } = await api.get(EP_ME);\n      setUser((data === null || data === void 0 ? void 0 : data.user) || null);\n      saveState({\n        user: (data === null || data === void 0 ? void 0 : data.user) || null\n      });\n    } catch {\n      localStorage.removeItem('token');\n      setUser(null);\n      saveState({\n        user: null\n      });\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n  useEffect(() => {\n    fetchMe();\n  }, [fetchMe]);\n  const login = useCallback(async (email, password) => {\n    const {\n      data\n    } = await api.post(EP_LOGIN, {\n      email,\n      password\n    });\n    if (!(data !== null && data !== void 0 && data.token)) throw new Error('No token');\n    localStorage.setItem('token', data.token);\n    setUser(data.user || null);\n    saveState({\n      user: data.user || null\n    });\n    return data.user;\n  }, []);\n  const register = useCallback(async (email, password, inviteCode = '') => {\n    const {\n      data\n    } = await api.post(EP_REGISTER, {\n      email,\n      password,\n      inviteCode\n    });\n    if (!(data !== null && data !== void 0 && data.token)) throw new Error('No token');\n    localStorage.setItem('token', data.token);\n    setUser(data.user || null);\n    saveState({\n      user: data.user || null\n    });\n    return data.user;\n  }, []);\n  const logout = useCallback(() => {\n    localStorage.removeItem('token');\n    setUser(null);\n    saveState({\n      user: null\n    });\n  }, []);\n  return {\n    user,\n    loading,\n    login,\n    logout,\n    register\n  };\n}\n_s(useAuthState, \"l4UN2rT6ktcozlM3zJT1SR/ed1A=\");\nconst AuthContext = /*#__PURE__*/createContext({\n  user: null,\n  loading: true,\n  login: async () => {},\n  logout: () => {},\n  register: async () => {}\n});\nexport function AuthProvider({\n  children\n}) {\n  _s2();\n  const auth = useAuthState();\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: auth,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 78,\n    columnNumber: 12\n  }, this);\n}\n_s2(AuthProvider, \"v5+xnRzRGgUkz6HrltagqFou1eE=\", false, function () {\n  return [useAuthState];\n});\n_c = AuthProvider;\nexport function useAuth() {\n  _s3();\n  return useContext(AuthContext);\n}\n_s3(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport default useAuth;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useCallback","useContext","useEffect","useState","api","jsxDEV","_jsxDEV","EP_ME","EP_LOGIN","EP_REGISTER","STORAGE_KEY","loadState","JSON","parse","localStorage","getItem","saveState","s","setItem","stringify","useAuthState","_s","_loadState","user","setUser","loading","setLoading","fetchMe","token","data","get","removeItem","login","email","password","post","Error","register","inviteCode","logout","AuthContext","AuthProvider","children","_s2","auth","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useAuth","_s3","$RefreshReg$"],"sources":["D:/Uknord5he/BH3/dev/diplomas/frontend/src/hooks/useAuth.js"],"sourcesContent":["// frontend/src/hooks/useAuth.js\r\nimport React, { createContext, useCallback, useContext, useEffect, useState } from 'react';\r\nimport api from '../services/api';\r\n\r\nconst EP_ME = '/me';\r\nconst EP_LOGIN = '/login';\r\nconst EP_REGISTER = '/register';\r\n\r\nconst STORAGE_KEY = 'auth/state/v1';\r\n\r\nfunction loadState() {\r\n    try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null'); }\r\n    catch { return null; }\r\n}\r\nfunction saveState(s) {\r\n    try { localStorage.setItem(STORAGE_KEY, JSON.stringify(s)); } catch {}\r\n}\r\n\r\nfunction useAuthState() {\r\n    const [user, setUser] = useState(loadState()?.user || null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const fetchMe = useCallback(async () => {\r\n        const token = localStorage.getItem('token');\r\n        if (!token) { setUser(null); setLoading(false); return; }\r\n        try {\r\n            const { data } = await api.get(EP_ME);\r\n            setUser(data?.user || null);\r\n            saveState({ user: data?.user || null });\r\n        } catch {\r\n            localStorage.removeItem('token');\r\n            setUser(null);\r\n            saveState({ user: null });\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => { fetchMe(); }, [fetchMe]);\r\n\r\n    const login = useCallback(async (email, password) => {\r\n        const { data } = await api.post(EP_LOGIN, { email, password });\r\n        if (!data?.token) throw new Error('No token');\r\n        localStorage.setItem('token', data.token);\r\n        setUser(data.user || null);\r\n        saveState({ user: data.user || null });\r\n        return data.user;\r\n    }, []);\r\n\r\n    const register = useCallback(async (email, password, inviteCode = '') => {\r\n        const { data } = await api.post(EP_REGISTER, { email, password, inviteCode });\r\n        if (!data?.token) throw new Error('No token');\r\n        localStorage.setItem('token', data.token);\r\n        setUser(data.user || null);\r\n        saveState({ user: data.user || null });\r\n        return data.user;\r\n    }, []);\r\n\r\n    const logout = useCallback(() => {\r\n        localStorage.removeItem('token');\r\n        setUser(null);\r\n        saveState({ user: null });\r\n    }, []);\r\n\r\n    return { user, loading, login, logout, register };\r\n}\r\n\r\nconst AuthContext = createContext({\r\n    user: null,\r\n    loading: true,\r\n    login: async () => {},\r\n    logout: () => {},\r\n    register: async () => {},\r\n});\r\n\r\nexport function AuthProvider({ children }) {\r\n    const auth = useAuthState();\r\n    return <AuthContext.Provider value={auth}>{children}</AuthContext.Provider>;\r\n}\r\n\r\nexport function useAuth() { return useContext(AuthContext); }\r\n\r\nexport default useAuth;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}