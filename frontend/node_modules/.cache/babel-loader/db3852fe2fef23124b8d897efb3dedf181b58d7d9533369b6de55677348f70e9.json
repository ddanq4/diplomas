{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useCallback, useEffect, useState } from 'react';\nimport api from '../services/api';\nconst STORAGE_KEY = 'auth/state/v1';\nexport function useAuth() {\n  _s();\n  const [user, setUser] = useState(() => {\n    try {\n      return JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null');\n    } catch {\n      return null;\n    }\n  });\n  const isAuthed = !!user;\n  const isAdmin = !!(user !== null && user !== void 0 && user.isAdmin);\n  const persist = u => {\n    setUser(u);\n    try {\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(u));\n    } catch {}\n  };\n  const refresh = useCallback(async () => {\n    try {\n      const {\n        data\n      } = await api.get('/auth/me'); // должен вернуть хотя бы { email, role? , isAdmin? }\n      const u = {\n        email: (data === null || data === void 0 ? void 0 : data.email) || (user === null || user === void 0 ? void 0 : user.email) || null,\n        isAdmin: !!(data !== null && data !== void 0 && data.isAdmin || (data === null || data === void 0 ? void 0 : data.role) === 'admin' || user !== null && user !== void 0 && user.isAdmin)\n      };\n      persist(u);\n    } catch {\n      // если нет /auth/me — оставляем то, что уже есть в localStorage\n    }\n  }, [user === null || user === void 0 ? void 0 : user.email, user === null || user === void 0 ? void 0 : user.isAdmin]);\n  useEffect(() => {\n    refresh();\n  }, [refresh]);\n  const login = async payload => {\n    await api.post('/auth/login', payload);\n    await refresh();\n  };\n  const logout = () => {\n    try {\n      localStorage.removeItem(STORAGE_KEY);\n    } catch {}\n    setUser(null);\n    // при необходимости дернуть /auth/logout\n  };\n  return {\n    user,\n    isAuthed,\n    isAdmin,\n    refresh,\n    login,\n    logout\n  };\n}\n_s(useAuth, \"tN4KI9ftSx1/21Kn+nHPQev9Kxk=\");\nexport default useAuth;","map":{"version":3,"names":["useCallback","useEffect","useState","api","STORAGE_KEY","useAuth","_s","user","setUser","JSON","parse","localStorage","getItem","isAuthed","isAdmin","persist","u","setItem","stringify","refresh","data","get","email","role","login","payload","post","logout","removeItem"],"sources":["D:/Uknord5he/BH3/dev/diplomas/frontend/src/hooks/useAuth.js"],"sourcesContent":["import { useCallback, useEffect, useState } from 'react';\r\nimport api from '../services/api';\r\n\r\nconst STORAGE_KEY = 'auth/state/v1';\r\n\r\nexport function useAuth() {\r\n    const [user, setUser] = useState(() => {\r\n        try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null'); }\r\n        catch { return null; }\r\n    });\r\n\r\n    const isAuthed = !!user;\r\n    const isAdmin  = !!user?.isAdmin;\r\n\r\n    const persist = (u) => {\r\n        setUser(u);\r\n        try { localStorage.setItem(STORAGE_KEY, JSON.stringify(u)); } catch {}\r\n    };\r\n\r\n    const refresh = useCallback(async () => {\r\n        try {\r\n            const { data } = await api.get('/auth/me'); // должен вернуть хотя бы { email, role? , isAdmin? }\r\n            const u = {\r\n                email: data?.email || user?.email || null,\r\n                isAdmin: !!(data?.isAdmin || data?.role === 'admin' || user?.isAdmin),\r\n            };\r\n            persist(u);\r\n        } catch {\r\n            // если нет /auth/me — оставляем то, что уже есть в localStorage\r\n        }\r\n    }, [user?.email, user?.isAdmin]);\r\n\r\n    useEffect(() => { refresh(); }, [refresh]);\r\n\r\n    const login = async (payload) => {\r\n        await api.post('/auth/login', payload);\r\n        await refresh();\r\n    };\r\n\r\n    const logout = () => {\r\n        try { localStorage.removeItem(STORAGE_KEY); } catch {}\r\n        setUser(null);\r\n        // при необходимости дернуть /auth/logout\r\n    };\r\n\r\n    return { user, isAuthed, isAdmin, refresh, login, logout };\r\n}\r\n\r\nexport default useAuth;\r\n"],"mappings":";AAAA,SAASA,WAAW,EAAEC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AACxD,OAAOC,GAAG,MAAM,iBAAiB;AAEjC,MAAMC,WAAW,GAAG,eAAe;AAEnC,OAAO,SAASC,OAAOA,CAAA,EAAG;EAAAC,EAAA;EACtB,MAAM,CAACC,IAAI,EAAEC,OAAO,CAAC,GAAGN,QAAQ,CAAC,MAAM;IACnC,IAAI;MAAE,OAAOO,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAACR,WAAW,CAAC,IAAI,MAAM,CAAC;IAAE,CAAC,CACvE,MAAM;MAAE,OAAO,IAAI;IAAE;EACzB,CAAC,CAAC;EAEF,MAAMS,QAAQ,GAAG,CAAC,CAACN,IAAI;EACvB,MAAMO,OAAO,GAAI,CAAC,EAACP,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAEO,OAAO;EAEhC,MAAMC,OAAO,GAAIC,CAAC,IAAK;IACnBR,OAAO,CAACQ,CAAC,CAAC;IACV,IAAI;MAAEL,YAAY,CAACM,OAAO,CAACb,WAAW,EAAEK,IAAI,CAACS,SAAS,CAACF,CAAC,CAAC,CAAC;IAAE,CAAC,CAAC,MAAM,CAAC;EACzE,CAAC;EAED,MAAMG,OAAO,GAAGnB,WAAW,CAAC,YAAY;IACpC,IAAI;MACA,MAAM;QAAEoB;MAAK,CAAC,GAAG,MAAMjB,GAAG,CAACkB,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC;MAC5C,MAAML,CAAC,GAAG;QACNM,KAAK,EAAE,CAAAF,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEE,KAAK,MAAIf,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEe,KAAK,KAAI,IAAI;QACzCR,OAAO,EAAE,CAAC,EAAEM,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAEN,OAAO,IAAI,CAAAM,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEG,IAAI,MAAK,OAAO,IAAIhB,IAAI,aAAJA,IAAI,eAAJA,IAAI,CAAEO,OAAO;MACxE,CAAC;MACDC,OAAO,CAACC,CAAC,CAAC;IACd,CAAC,CAAC,MAAM;MACJ;IAAA;EAER,CAAC,EAAE,CAACT,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEe,KAAK,EAAEf,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEO,OAAO,CAAC,CAAC;EAEhCb,SAAS,CAAC,MAAM;IAAEkB,OAAO,CAAC,CAAC;EAAE,CAAC,EAAE,CAACA,OAAO,CAAC,CAAC;EAE1C,MAAMK,KAAK,GAAG,MAAOC,OAAO,IAAK;IAC7B,MAAMtB,GAAG,CAACuB,IAAI,CAAC,aAAa,EAAED,OAAO,CAAC;IACtC,MAAMN,OAAO,CAAC,CAAC;EACnB,CAAC;EAED,MAAMQ,MAAM,GAAGA,CAAA,KAAM;IACjB,IAAI;MAAEhB,YAAY,CAACiB,UAAU,CAACxB,WAAW,CAAC;IAAE,CAAC,CAAC,MAAM,CAAC;IACrDI,OAAO,CAAC,IAAI,CAAC;IACb;EACJ,CAAC;EAED,OAAO;IAAED,IAAI;IAAEM,QAAQ;IAAEC,OAAO;IAAEK,OAAO;IAAEK,KAAK;IAAEG;EAAO,CAAC;AAC9D;AAACrB,EAAA,CAzCeD,OAAO;AA2CvB,eAAeA,OAAO","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}