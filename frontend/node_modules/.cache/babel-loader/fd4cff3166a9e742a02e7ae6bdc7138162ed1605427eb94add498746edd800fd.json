{"ast":null,"code":"var _jsxFileName = \"D:\\\\Uknord5he\\\\BH3\\\\dev\\\\diplomas\\\\frontend\\\\src\\\\hooks\\\\useAuth.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$();\nimport React, { createContext, useCallback, useContext, useEffect, useState } from 'react';\nimport api from '../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst STORAGE_KEY = 'auth/state/v1';\n\n/** Внутренний стейт авторизации с персистом в localStorage и мягким /auth/me */\nfunction useAuthState() {\n  _s();\n  const [user, setUser] = useState(() => {\n    try {\n      return JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null');\n    } catch {\n      return null;\n    }\n  });\n  const isAuthed = !!user;\n  const isAdmin = !!(user !== null && user !== void 0 && user.isAdmin);\n  const persist = u => {\n    setUser(u);\n    try {\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(u));\n    } catch {}\n  };\n  const refresh = useCallback(async () => {\n    try {\n      const {\n        data\n      } = await api.get('/auth/me'); // если нет — тихо игнорируем\n      const u = {\n        email: (data === null || data === void 0 ? void 0 : data.email) || (user === null || user === void 0 ? void 0 : user.email) || null,\n        isAdmin: !!(data !== null && data !== void 0 && data.isAdmin || (data === null || data === void 0 ? void 0 : data.role) === 'admin' || user !== null && user !== void 0 && user.isAdmin)\n      };\n      persist(u);\n    } catch {\n      // оставляем состояние из localStorage\n    }\n  }, [user === null || user === void 0 ? void 0 : user.email, user === null || user === void 0 ? void 0 : user.isAdmin]);\n  useEffect(() => {\n    refresh();\n  }, [refresh]);\n  const login = async payload => {\n    await api.post('/auth/login', payload);\n    await refresh();\n  };\n  const logout = async () => {\n    try {\n      await api.post('/auth/logout');\n    } catch {}\n    try {\n      localStorage.removeItem(STORAGE_KEY);\n    } catch {}\n    setUser(null);\n  };\n  return {\n    user,\n    isAuthed,\n    isAdmin,\n    refresh,\n    login,\n    logout\n  };\n}\n\n/** Контекст + провайдер */\n_s(useAuthState, \"tN4KI9ftSx1/21Kn+nHPQev9Kxk=\");\nconst AuthContext = /*#__PURE__*/createContext({\n  user: null,\n  isAuthed: false,\n  isAdmin: false,\n  refresh: async () => {},\n  login: async () => {},\n  logout: async () => {}\n});\nexport function AuthProvider({\n  children\n}) {\n  _s2();\n  const auth = useAuthState();\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: auth,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 62,\n    columnNumber: 12\n  }, this);\n}\n\n/** Хук-доступ к контексту */\n_s2(AuthProvider, \"v5+xnRzRGgUkz6HrltagqFou1eE=\", false, function () {\n  return [useAuthState];\n});\n_c = AuthProvider;\nexport function useAuth() {\n  _s3();\n  return useContext(AuthContext);\n}\n_s3(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport default useAuth;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useCallback","useContext","useEffect","useState","api","jsxDEV","_jsxDEV","STORAGE_KEY","useAuthState","_s","user","setUser","JSON","parse","localStorage","getItem","isAuthed","isAdmin","persist","u","setItem","stringify","refresh","data","get","email","role","login","payload","post","logout","removeItem","AuthContext","AuthProvider","children","_s2","auth","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useAuth","_s3","$RefreshReg$"],"sources":["D:/Uknord5he/BH3/dev/diplomas/frontend/src/hooks/useAuth.js"],"sourcesContent":["import React, { createContext, useCallback, useContext, useEffect, useState } from 'react';\r\nimport api from '../services/api';\r\n\r\nconst STORAGE_KEY = 'auth/state/v1';\r\n\r\n/** Внутренний стейт авторизации с персистом в localStorage и мягким /auth/me */\r\nfunction useAuthState() {\r\n    const [user, setUser] = useState(() => {\r\n        try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null'); }\r\n        catch { return null; }\r\n    });\r\n\r\n    const isAuthed = !!user;\r\n    const isAdmin  = !!user?.isAdmin;\r\n\r\n    const persist = (u) => {\r\n        setUser(u);\r\n        try { localStorage.setItem(STORAGE_KEY, JSON.stringify(u)); } catch {}\r\n    };\r\n\r\n    const refresh = useCallback(async () => {\r\n        try {\r\n            const { data } = await api.get('/auth/me'); // если нет — тихо игнорируем\r\n            const u = {\r\n                email: data?.email || user?.email || null,\r\n                isAdmin: !!(data?.isAdmin || data?.role === 'admin' || user?.isAdmin),\r\n            };\r\n            persist(u);\r\n        } catch {\r\n            // оставляем состояние из localStorage\r\n        }\r\n    }, [user?.email, user?.isAdmin]);\r\n\r\n    useEffect(() => { refresh(); }, [refresh]);\r\n\r\n    const login = async (payload) => {\r\n        await api.post('/auth/login', payload);\r\n        await refresh();\r\n    };\r\n\r\n    const logout = async () => {\r\n        try { await api.post('/auth/logout'); } catch {}\r\n        try { localStorage.removeItem(STORAGE_KEY); } catch {}\r\n        setUser(null);\r\n    };\r\n\r\n    return { user, isAuthed, isAdmin, refresh, login, logout };\r\n}\r\n\r\n/** Контекст + провайдер */\r\nconst AuthContext = createContext({\r\n    user: null,\r\n    isAuthed: false,\r\n    isAdmin: false,\r\n    refresh: async () => {},\r\n    login: async () => {},\r\n    logout: async () => {},\r\n});\r\n\r\nexport function AuthProvider({ children }) {\r\n    const auth = useAuthState();\r\n    return <AuthContext.Provider value={auth}>{children}</AuthContext.Provider>;\r\n}\r\n\r\n/** Хук-доступ к контексту */\r\nexport function useAuth() {\r\n    return useContext(AuthContext);\r\n}\r\n\r\nexport default useAuth;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}