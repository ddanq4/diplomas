{"ast":null,"code":"var _jsxFileName = \"D:\\\\Uknord5he\\\\BH3\\\\dev\\\\diplomas\\\\frontend\\\\src\\\\pages\\\\AdminPage.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { getDiplomas, getFilters, verifyDiploma, deleteDiploma } from '../services/diplomaService';\nimport FilterBar from '../components/FilterBar';\nimport DiplomaTable from '../components/DiplomaTable';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function AdminPage() {\n  _s();\n  const [opts, setOpts] = useState({\n    facultiesOptions: [],\n    specialtyOptionsByFacultyKey: {},\n    specialtyToFaculty: {},\n    allSpecialtyOptions: []\n  });\n  const [q, setQ] = useState('');\n  const [scope, setScope] = useState('unverified'); // дефолт — непідтверджені\n  const [sort, setSort] = useState('createdAt');\n  const [dir, setDir] = useState('desc');\n  const [facultyKey, setFacultyKey] = useState('');\n  const [specialty, setSpecialty] = useState('');\n  const [page, setPage] = useState(1);\n  const [rows, setRows] = useState([]);\n  const [total, setTotal] = useState(0);\n  const [busy, setBusy] = useState(false);\n  useEffect(() => {\n    (async () => {\n      const f = await getFilters();\n      const stf = {};\n      const all = [];\n      const seen = new Set();\n      Object.entries(f.specialtyOptionsByFacultyKey || {}).forEach(([fk, arr]) => {\n        (arr || []).forEach(s => {\n          stf[s.key] = fk;\n          if (!seen.has(s.key)) {\n            seen.add(s.key);\n            all.push({\n              key: s.key,\n              label: s.label\n            });\n          }\n        });\n      });\n      setOpts({\n        facultiesOptions: f.facultiesOptions || [],\n        specialtyOptionsByFacultyKey: f.specialtyOptionsByFacultyKey || {},\n        specialtyToFaculty: stf,\n        allSpecialtyOptions: all\n      });\n    })();\n  }, []);\n  useEffect(() => {\n    if (!facultyKey || !specialty) return;\n    const fkOfSpec = opts.specialtyToFaculty[specialty];\n    if (fkOfSpec && fkOfSpec !== facultyKey) setSpecialty('');\n  }, [facultyKey, specialty, opts.specialtyToFaculty]);\n  useEffect(() => {\n    if (!specialty) return;\n    const fk = opts.specialtyToFaculty[specialty];\n    if (fk && fk !== facultyKey) setFacultyKey(fk);\n  }, [specialty, facultyKey, opts.specialtyToFaculty]);\n  const specOptions = useMemo(() => {\n    if (facultyKey) return opts.specialtyOptionsByFacultyKey[facultyKey] || [];\n    return opts.allSpecialtyOptions || [];\n  }, [facultyKey, opts.specialtyOptionsByFacultyKey, opts.allSpecialtyOptions]);\n  const fetchData = async () => {\n    setBusy(true);\n    try {\n      const params = {\n        q,\n        sort,\n        dir,\n        page,\n        is_verified: scope === 'verified' ? 'true' : scope === 'unverified' ? 'false' : undefined,\n        faculty: facultyKey || undefined,\n        specialty: specialty || undefined\n      };\n      const {\n        rows,\n        total\n      } = await getDiplomas(params);\n      setRows(rows || []);\n      setTotal(total || 0);\n    } finally {\n      setBusy(false);\n    }\n  };\n  useEffect(() => {\n    fetchData();\n  }, [q, facultyKey, specialty, scope, sort, dir, page]);\n  const onVerify = async (id, curr) => {\n    await verifyDiploma(id, !curr);\n    await fetchData();\n  };\n  const onDelete = async id => {\n    if (!window.confirm('Видалити запис?')) return;\n    await deleteDiploma(id);\n    await fetchData();\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"space-y-6\",\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      className: \"text-2xl font-semibold\",\n      children: \"\\u0410\\u0434\\u043C\\u0456\\u043D\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(FilterBar, {\n      q: q,\n      setQ: setQ,\n      scope: scope,\n      setScope: setScope,\n      sort: sort,\n      setSort: setSort,\n      dir: dir,\n      setDir: setDir,\n      facultyKey: facultyKey,\n      setFacultyKey: setFacultyKey,\n      specialty: specialty,\n      setSpecialty: setSpecialty,\n      facultiesOptions: opts.facultiesOptions,\n      specialtyOptions: specOptions,\n      onRefresh: fetchData,\n      allowUnverified: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(DiplomaTable, {\n      rows: rows,\n      total: total,\n      page: page,\n      setPage: setPage,\n      busy: busy,\n      onVerify: onVerify,\n      onDelete: onDelete\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 86,\n    columnNumber: 7\n  }, this);\n}\n_s(AdminPage, \"Sbbz7j6w0weklm2chDU4qNt1D4Q=\");\n_c = AdminPage;\nvar _c;\n$RefreshReg$(_c, \"AdminPage\");","map":{"version":3,"names":["React","useEffect","useMemo","useState","getDiplomas","getFilters","verifyDiploma","deleteDiploma","FilterBar","DiplomaTable","jsxDEV","_jsxDEV","AdminPage","_s","opts","setOpts","facultiesOptions","specialtyOptionsByFacultyKey","specialtyToFaculty","allSpecialtyOptions","q","setQ","scope","setScope","sort","setSort","dir","setDir","facultyKey","setFacultyKey","specialty","setSpecialty","page","setPage","rows","setRows","total","setTotal","busy","setBusy","f","stf","all","seen","Set","Object","entries","forEach","fk","arr","s","key","has","add","push","label","fkOfSpec","specOptions","fetchData","params","is_verified","undefined","faculty","onVerify","id","curr","onDelete","window","confirm","className","children","fileName","_jsxFileName","lineNumber","columnNumber","specialtyOptions","onRefresh","allowUnverified","_c","$RefreshReg$"],"sources":["D:/Uknord5he/BH3/dev/diplomas/frontend/src/pages/AdminPage.jsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\nimport { getDiplomas, getFilters, verifyDiploma, deleteDiploma } from '../services/diplomaService';\nimport FilterBar from '../components/FilterBar';\nimport DiplomaTable from '../components/DiplomaTable';\n\nexport default function AdminPage() {\n  const [opts, setOpts] = useState({\n    facultiesOptions: [],\n    specialtyOptionsByFacultyKey: {},\n    specialtyToFaculty: {},\n    allSpecialtyOptions: [],\n  });\n\n  const [q, setQ] = useState('');\n  const [scope, setScope] = useState('unverified'); // дефолт — непідтверджені\n  const [sort, setSort] = useState('createdAt');\n  const [dir, setDir] = useState('desc');\n  const [facultyKey, setFacultyKey] = useState('');\n  const [specialty, setSpecialty] = useState('');\n  const [page, setPage] = useState(1);\n\n  const [rows, setRows] = useState([]);\n  const [total, setTotal] = useState(0);\n  const [busy, setBusy] = useState(false);\n\n  useEffect(() => {\n    (async () => {\n      const f = await getFilters();\n      const stf = {}; const all = []; const seen = new Set();\n      Object.entries(f.specialtyOptionsByFacultyKey || {}).forEach(([fk, arr]) => {\n        (arr || []).forEach(s => {\n          stf[s.key] = fk;\n          if (!seen.has(s.key)) { seen.add(s.key); all.push({ key: s.key, label: s.label }); }\n        });\n      });\n      setOpts({\n        facultiesOptions: f.facultiesOptions || [],\n        specialtyOptionsByFacultyKey: f.specialtyOptionsByFacultyKey || {},\n        specialtyToFaculty: stf,\n        allSpecialtyOptions: all,\n      });\n    })();\n  }, []);\n\n  useEffect(() => {\n    if (!facultyKey || !specialty) return;\n    const fkOfSpec = opts.specialtyToFaculty[specialty];\n    if (fkOfSpec && fkOfSpec !== facultyKey) setSpecialty('');\n  }, [facultyKey, specialty, opts.specialtyToFaculty]);\n\n  useEffect(() => {\n    if (!specialty) return;\n    const fk = opts.specialtyToFaculty[specialty];\n    if (fk && fk !== facultyKey) setFacultyKey(fk);\n  }, [specialty, facultyKey, opts.specialtyToFaculty]);\n\n  const specOptions = useMemo(() => {\n    if (facultyKey) return opts.specialtyOptionsByFacultyKey[facultyKey] || [];\n    return opts.allSpecialtyOptions || [];\n  }, [facultyKey, opts.specialtyOptionsByFacultyKey, opts.allSpecialtyOptions]);\n\n  const fetchData = async () => {\n    setBusy(true);\n    try {\n      const params = {\n        q, sort, dir, page,\n        is_verified: scope === 'verified' ? 'true' : (scope === 'unverified' ? 'false' : undefined),\n        faculty: facultyKey || undefined,\n        specialty: specialty || undefined,\n      };\n      const { rows, total } = await getDiplomas(params);\n      setRows(rows || []);\n      setTotal(total || 0);\n    } finally { setBusy(false); }\n  };\n\n  useEffect(() => { fetchData(); }, [q, facultyKey, specialty, scope, sort, dir, page]);\n\n  const onVerify = async (id, curr) => { await verifyDiploma(id, !curr); await fetchData(); };\n  const onDelete = async (id) => {\n    if (!window.confirm('Видалити запис?')) return;\n    await deleteDiploma(id); await fetchData();\n  };\n\n  return (\n      <div className=\"space-y-6\">\n        <h1 className=\"text-2xl font-semibold\">Адмін</h1>\n        <FilterBar\n            q={q} setQ={setQ}\n            scope={scope} setScope={setScope}\n            sort={sort} setSort={setSort}\n            dir={dir} setDir={setDir}\n            facultyKey={facultyKey} setFacultyKey={setFacultyKey}\n            specialty={specialty} setSpecialty={setSpecialty}\n            facultiesOptions={opts.facultiesOptions}\n            specialtyOptions={specOptions}\n            onRefresh={fetchData}\n            allowUnverified={true}\n        />\n        <DiplomaTable\n            rows={rows}\n            total={total}\n            page={page}\n            setPage={setPage}\n            busy={busy}\n            onVerify={onVerify}\n            onDelete={onDelete}\n        />\n      </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}